## ã€Œ çº¿ç¨‹çš„å®ç° ã€

<div align="right">
    <a href="https://github.com/fmw666/Linux#-ç›®å½•å¯¼èˆª">è¿”å›ç›®å½•å¯¼èˆª â†©</a>
</div>

+ **[çº¿ç¨‹çš„åˆ›å»º](#-çº¿ç¨‹çš„åˆ›å»º)**

+ **[çº¿ç¨‹çš„é€€å‡º](#-çº¿ç¨‹çš„é€€å‡º)**

+ **[çº¿ç¨‹çš„ç­‰å¾…](#-çº¿ç¨‹çš„ç­‰å¾…)**

+ **[çº¿ç¨‹çš„ä¾‹å­](#-çº¿ç¨‹çš„ä¾‹å­)**

### ğŸ’¬ çº¿ç¨‹çš„åˆ›å»º

+ å‡½æ•°åï¼špthread_create

+ å¤´æ–‡ä»¶ï¼š

    ```c
    #include <pthread.h>
    ```

+ å‡½æ•°åŸå‹ï¼š

    ```c
    int pthread_create(pthread_t *thread, thread_attr_t *attr, void* (*start_routine)(void *), void *arg);
    ```

    + threadï¼šçº¿ç¨‹æ ‡è¯†ç¬¦

    + attrï¼šçº¿ç¨‹å±æ€§è®¾ç½®ï¼Œé€šå¸¸ NULL

    + start_routineï¼šçº¿ç¨‹å‡½æ•°èµ·å§‹åœ°å€

    + argï¼šä¼ é€’ç»™ start_routine çš„å‚æ•°

### ğŸ’¬ çº¿ç¨‹çš„é€€å‡º

+ å‡½æ•°åï¼špthread_create

+ å¤´æ–‡ä»¶ï¼š

    ```c
    #include <pthread.h>
    ```

+ å‡½æ•°åŸå‹ï¼š

    ```c
    void pthread_exit(void *retval);
    ```

    + retvalï¼špthread_exit è°ƒç”¨è€…çº¿ç¨‹çš„è¿”å›å€¼ï¼Œå¯ç”±å…¶ä»–å‡½æ•°å’Œ pthread_join æ¥æ£€æµ‹è·å–

### ğŸ’¬ çº¿ç¨‹çš„ç­‰å¾…

+ å‡½æ•°åï¼špthread_join

+ å¤´æ–‡ä»¶ï¼š

    ```c
    #include <pthread.h>
    ```

+ å‡½æ•°åŸå‹ï¼š

    ```c
    int pthread_join(pthread_t *thread, void **thread_return);
    ```

    + threadï¼šç­‰å¾…çº¿ç¨‹çš„æ ‡è¯†ç¬¦

    + thread_returnï¼šç”¨æˆ·å®šä¹‰æŒ‡é’ˆï¼Œç”¨æ¥å­˜æ”¾è¢«ç­‰å¾…çº¿ç¨‹çš„è¿”å›å€¼â€”â€”\*retval

### ğŸ’¬ çº¿ç¨‹çš„ä¾‹å­

```c
#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>
#include <pthread.h>

char message[] = "Hello World!";

void* thread_function(void *arg)
{
    printf("thread_function is running. Argument is %s\n", (char *)arg);

    sleep(3);
    strcpy(message, "Bye!");

    pthread_exit("thread_function is over.");
}

int main()
{
    int res;
    pthread_t a_thread;
    void *thread_result;

    res = pthread_create(&a_thread, NULL, thread_function, (void *)message);
    if (res != 0)
    {
        perrpr("Thread creation failed");
        exit(EXIT_FAILURE);
    }

    printf("Waiting for thread to finish...\n");
    res = pthread_join(a_thread, &thread_result);
    if (res != 0)
    {
        perror("Thread join failed");
        exit(EXIT_FAILURE);
    }

    printf("Thread joined, it returned %s\n", (char *)thread_result);

    printf("Message is now %s\n", message);
    exit(EXIT_SUCCESS);
}
```

> **æ³¨æ„ï¼š** pthread åº“ä¸æ˜¯ Linux ç³»ç»Ÿé»˜è®¤åº“ï¼Œé“¾æ¥æ—¶éœ€è¦ä½¿ç”¨åŠ¨æ€é“¾æ¥åº“ libpthread.aï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ pthread_create åˆ›å»ºçº¿ç¨‹æ—¶ï¼Œåœ¨ç¼–è¯‘ä¸­è¦åŠ  `-lpthread` å‚æ•°ã€‚å¦‚ï¼š`gcc test.c -lphtread -o test.out`

<div align="center">
    - End -
</div>