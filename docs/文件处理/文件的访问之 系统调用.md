## 「 文件的访问之 系统调用 」

<div align="right">
    <a href="https://github.com/fmw666/Linux#-目录导航">返回目录导航 ↩</a>
</div>

<br>

&emsp;&emsp;**说明：** 基于 [POSIX(Portable Operating System Interface)](#welcome) 标准，采用 C 语言，实现了为应用程序提供与操作系统内核通信的服务的API。

### 💬 open 系统调用

+ 系统调用名：**[open](#welcome)**

+ 头文件：**[unistd.h](#welcome)**

+ 功能：*打开 path 所指的文件*

+ 函数定义：

    + **int open(const char \*path, int oflags)**

    + **int open(const char \*path, int oflags, mode_t mode)**

+ 其中：

    + **path：** 文件所在路径

    + **oflags：** 设置 open 文件操作类型

    + **mode：** 设置 open 文件模式

    + **返回值：** 打开成功，返回一个唯一的文件描述符；不成功，返回 -1，并设置相应的 errno　变量以指明出错的原因

### 💬 close 系统调用

+ 系统调用名：**[close](#welcome)**

+ 头文件：**[unistd.h](#welcome)**

+ 功能：*将与 fildes 文件描述符相关联的文件断开*

+ 函数定义：

    + **int close(int fildes)**

+ 其中：

    + **fildes：** 文件描述符

    + **返回值：** 关闭成功，返回 0；不成功，返回 -1

### 💬 write系统调用

+ 系统调用名：**[write](#welcome)**

+ 头文件：**[unistd.h](#welcome)**

+ 功能：*将 buff 中的前 nbytes 个字节的数据写入到与 fildes 相关联的文件描述符中*

+ 函数定义：

    + **size_t write(int fildes, const void *buff, size_t nbytes)**

+ 其中：

    + **fildes：** 文件描述符

    + **buff：** 数据的来源

    + **nbytes：** 数据的长度（以字节为单位）

    + **返回值：** 写入成功，返回值的范围为 0~nbytes；不成功，返回 -1，对应错误代码保存在全局变量 errno 中

### 💬 read

+ 系统调用名：**[read](#welcome)**

+ 头文件：**[unistd.h](#welcome)**

+ 功能：*将与fildes文件描述符相关联的文件的前 nbytes 个字节的数据读入到 buff 中*

+ 函数定义：

    + **size_t read(int fildes, const void *buff, size_t nbytes)**

+ 其中：

    + **fildes：** 文件描述符

    + **buff：** 数据的来源

    + **nbytes：** 数据的长度（以字节为单位）

    + **返回值：** 读取成功，返回值的范围为 0~nbytes；不成功，返回 -1，对应错误代码保存在全局变量 errno 中

### 💬 fcntl

+ 系统调用名：**[fcntl](#welcome)**

+ 头文件：**[fcntl.h](#welcome)**

+ 功能：*修改某个文件描述符的特性*

+ 函数定义：

    + **int fcntl(int fildes, int cmd)**

    + **int fcntl(int fildes, int cmd, long arg)**

    + **int fcntl(int fildes, int cmd, struct flock \*lock)**

+ 其中：

    + **fildes：** 需要修改属性的文件描述符

    + **cmd：** 将要操作的指令，其中指令如下

        + [F_DUPFD](#welcome) 用来查找大于或等于参数 arg 的最小且仍未使用的文件描述符，并且复制参数 fildes 的文件描述符。执行成功则返回新复制的文件描述符。新描述符与 fildes 共享同一文件表项，但是新描述符有它自己的一套文件描述符标志，其中 FD_CLOEXEC 文件描述符标志被清除。

        + [F_GETFD](#welcome) 取得 close-on-exec 旗标。若此旗标的 FD_CLOEXEC 位为 0，代表在调用 exec() 相关函数时文件将不会关闭。

        + [F_SETFD](#welcome) 设置 close-on-exec 旗标。该旗标以参数 arg 的 FD_CLOEXEC 位决定。

        + [F_GETFL](#welcome) 取得文件描述符状态旗标，此旗标为 open() 的参数 flags。

        + [F_SETFL](#welcome) 设置文件描述符状态旗标，参数 arg 为新旗标，但只允许 O_APPEND、O_NONBLOCK 和 O_ASYNC 位的改变，其他位的改变将不受影响。

        + [F_GETLK](#welcome) 取得文件锁定的状态。

        + [F_SETLK](#welcome) 设置文件锁定的状态。此时 flock 结构的 l_type 值必须是 F_RDLCK、F_WRLCK 或 F_UNLCK。如果无法建立锁定，则返回 -1，错误代码为 EACCES 或 EAGAIN。

        + [F_SETLKW](#welcome) [F_SETLK](#welcome) 作用相同，但是无法建立锁定时，此调用会一直等到锁定动作成功为止。若在等待锁定的过程中被信号中断，会立即返回 -1，错误代码为 EINTR。

    + **lock：** flock 结构指针定义如下

        ```c
        struct flock
        {
            short int l_type;
            short int l_whence;
            off_t l_start;
            off_t l_len;
            pid_t l_pid;
        };
        ```

        + [l_type](#welcome) 有三种状态：F_RDLCK 建立一个供读取用的锁定、F_WRLCK 建立一个供写入用的锁定、F_UNLCK 删除之前建立的锁定。

        + [l_whence](#welcome) 也有三种方式：SEEK_SET 以文件开头为锁定的起始位置、SEEK_CUR 以目前文件读写位置为锁定的起始位置、SEEK_END 以文件结尾为锁定的起始位置。

        + [l_start](#welcome) 表示相对 l_whence 位置的偏移量，两者一起确定锁定区域的开始位置。

        + [l_len](#welcome) 表示锁定区域的长度，如果为 0 表示从起点（由 l_whence 和 l_start 决定的开始位置）开始直到最大可能偏移量为止。即不管在后面增加多少数据都在锁的范围内。

    + **返回值：** 返回成功，依赖于 cmd 的值；不成功，返回 -1，错误原因存于 errno 中

### 💬 lseek

### 💬 lstat


### 💬 fstat


### 💬 stat

### 💬 mmap

### 💬 munmap

<div align="center">
    - End -
</div>